<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <meta charset="UTF-8">
    <title>Tạo Dự Án Mới</title>
</head>
<body>
<div class="container">
    <h3>Tạo dự án mới</h3>
    <hr>
    <form action="#" th:action="@{/projects/save}" method="POST" th:object="${project}">
        <div class="row">
            <!-- Bên trái -->
            <div class="col-md-6">
                <div class="form-group">
                    <label for="tenDuAn">Tên dự án:</label>
                    <input type="text" id="tenDuAn" th:field="*{tenDuAn}" class="form-control">
                </div>
                <div class="form-group">
                    <label for="moTa">Mô tả:</label>
                    <textarea id="moTa" th:field="*{moTa}" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <label for="ngayBatDau">Ngày bắt đầu:</label>
                    <input type="date" id="ngayBatDau" th:field="*{ngayBatDau}" class="form-control">
                </div>
                <div class="form-group">
                    <label for="ngayKetThuc">Ngày kết thúc:</label>
                    <input type="date" id="ngayKetThuc" th:field="*{ngayKetThuc}" class="form-control">
                </div>
                Phòng ban:
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
                <script>
                    $(document).ready(function(){
                      $("#departmentSelect").change(function(){
                        var departmentId = $(this).val();
                        $.get("/employees/listByDepartment", {departmentId: departmentId}, function(data){
                          var employeeSelect = $("#employeeSelect");
                          employeeSelect.empty();
                          $.each(data, function(index, employee){
                            employeeSelect.append(new Option(employee.name, employee.id));
                          });
                        });
                      });
                    });
                </script>

                <select id="departmentSelect" th:field="*{departments}" class="form-control" onchange="fetchEmployeesByDepartment()">
                    <option th:each="department : ${departments}"
                            th:value="${department.maPB}"
                            th:text="${department.tenPB}">
                    </option>
                </select>
                <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


                </select>
                <button id="fetchEmployeesButton" type="button" class="btn btn-primary">Hiển thị nhân viên</button>
            </div>
            <!-- Bên phải -->
            <div class="col-md-6">


                <table class="table">
                    <thead>
                    <tr>
                        <th>Họ và tên</th>
                        <th>Ngày sinh</th>
                        <th>Số điện thoại</th>
                        <th>Chọn</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="employee : ${employees}">
                        <td th:text="${employee.hoTen}"></td>
                        <td th:text="${employee.ngaySinh}"></td>
                        <td th:text="${employee.soDienThoai}"></td>
                        <td>
                            <button type="button" class="btn btn-primary" th:onclick="'selectEmployee(' + ${employee.id} + ')'">Chọn</button>
                        </td>
                    </tr>
                    </tbody>
                </table>

                </select>
                <h5>Nhân viên đã chọn:</h5>
                <ul id="selectedEmployees">
                    <!-- Selected employees will be added dynamically -->
                </ul>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Lưu</button>
    </form>
    <hr>
    <a th:href = "@{/projects/list}">Quay lại</a>
</div>
<script>
    $(document).ready(function(){
        $("form").submit(function(){
            var selectedEmployeeIds = $("#employeeSelect").val();
            $("#selectedEmployeeIds").val(selectedEmployeeIds.join(","));
        });
    });
</script>
<script>
    <script>
    function fetchEmployeesByDepartment() {
        var departmentId = document.getElementById("departmentSelect").value;
        fetch('/employees/listByDepartment?departmentId=' + departmentId)
            .then(response => response.json())
            .then(data => {
                var employeeTable = document.getElementById("employeeTable");
                employeeTable.innerHTML = ""; // Clear the table
                data.forEach(employee => {
                    var row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${employee.hoTen}</td>
                        <td>${employee.ngaySinh}</td>
                        <td>${employee.soDienThoai}</td>
                        <td>
                            <button type="button" class="btn btn-primary" onclick="selectEmployee(${employee.id})">Chọn</button>
                        </td>
                    `;
                    employeeTable.appendChild(row);
            });
        });
}
</script>

</body>
</html>